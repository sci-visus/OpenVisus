/*-----------------------------------------------------------------------------
Copyright(c) 2010 - 2018 ViSUS L.L.C.,
Scientific Computing and Imaging Institute of the University of Utah

ViSUS L.L.C., 50 W.Broadway, Ste. 300, 84101 - 2044 Salt Lake City, UT
University of Utah, 72 S Central Campus Dr, Room 3750, 84112 Salt Lake City, UT

All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are met :

* Redistributions of source code must retain the above copyright notice, this
list of conditions and the following disclaimer.

* Redistributions in binary form must reproduce the above copyright notice,
this list of conditions and the following disclaimer in the documentation
and/or other materials provided with the distribution.

* Neither the name of the copyright holder nor the names of its
contributors may be used to endorse or promote products derived from
this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED.IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
DAMAGES(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
OR TORT(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

For additional information about this project contact : pascucci@acm.org
For support : support@visus.net
-----------------------------------------------------------------------------*/

#include <Visus/GLMesh.h>

namespace Visus {


///////////////////////////////////////////////
GLMesh::GLMesh() {
}

///////////////////////////////////////////////
void GLMesh::begin(int primitive,int vertices_per_batch)
{
  if (vertices_per_batch>0)
  {
    const int align_nvertices[]={1,2,2,2,3,3,3,4};
    int N=align_nvertices[primitive];
    vertices_per_batch = std::max(N,vertices_per_batch + ((vertices_per_batch % N)?(N-(vertices_per_batch % N)):0));
  }
  VisusAssert(this->primitive==-1 || this->primitive==primitive);
  this->primitive=primitive;
  this->building.vertices_per_batch=vertices_per_batch;
}

///////////////////////////////////////////////
void GLMesh::end() {
  flush();
}

///////////////////////////////////////////////
void GLMesh::flush()
{
  int nvertices = (int)building.vertices.size();

  if (!nvertices)
    return;

  VisusAssert(building.vertices   .empty() || building.vertices   .size()== nvertices);
  VisusAssert(building.normals    .empty() || building.normals    .size()== nvertices);
  VisusAssert(building.colors     .empty() || building.colors     .size()== nvertices);
  VisusAssert(building.texcoords2f.empty() || building.texcoords2f.size()== nvertices);
  VisusAssert(building.texcoords3f.empty() || building.texcoords3f.size()== nvertices);

  //Quads are not supported
  if (bool bQuadsNotSupported=VISUS_OPENGL_ES && primitive==GL_QUADS)
  {
    primitive   = GL_TRIANGLES;
    ConvertQuadsToTriangles(building.vertices);
    ConvertQuadsToTriangles(building.normals);
    ConvertQuadsToTriangles(building.colors);
    ConvertQuadsToTriangles(building.texcoords2f);
    ConvertQuadsToTriangles(building.texcoords3f);
  }

  GLBatch batch;

  VisusAssert(building.texcoords2f.empty() || building.texcoords3f.empty());

  if (!building.vertices   .empty()) {batch.vertices   =std::make_shared<GLArrayBuffer>(DTypes::FLOAT32_RGB , nvertices, HeapMemory::createManaged(&building.vertices   [0][0],nvertices * sizeof(Point3f))); building.vertices   .clear();}
  if (!building.normals    .empty()) {batch.normals    =std::make_shared<GLArrayBuffer>(DTypes::FLOAT32_RGB , nvertices, HeapMemory::createManaged(&building.normals    [0][0],nvertices * sizeof(Point3f))); building.normals    .clear();}
  if (!building.colors     .empty()) {batch.colors     =std::make_shared<GLArrayBuffer>(DTypes::FLOAT32_RGBA, nvertices, HeapMemory::createManaged(&building.colors     [0][0],nvertices * sizeof(Point4f))); building.colors     .clear();}
  if (!building.texcoords2f.empty()) {batch.texcoords  =std::make_shared<GLArrayBuffer>(DTypes::FLOAT32_GA  , nvertices, HeapMemory::createManaged(&building.texcoords2f[0][0],nvertices * sizeof(Point3f))); building.texcoords2f.clear();}
  if (!building.texcoords3f.empty()) {batch.texcoords  =std::make_shared<GLArrayBuffer>(DTypes::FLOAT32_RGB , nvertices, HeapMemory::createManaged(&building.texcoords3f[0][0],nvertices * sizeof(Point3f))); building.texcoords3f.clear();}
   
  this->batches.push_back(batch);
  this->building.vertices_per_batch=0;
}


///////////////////////////////////////////////////////////////
GLMesh GLMesh::SolidSphere(const int N)
{
#if 1
float triangles[]=
{
  0.707107f,0.707107f,0.000000f,0.382683f,0.923880f,0.000000f,0.353553f,0.923880f,0.146447f,
  0.707107f,0.707107f,0.000000f,0.353553f,0.923880f,0.146447f,0.653281f,0.707107f,0.270598f,
  0.653281f,0.707107f,0.270598f,0.353553f,0.923880f,0.146447f,0.270598f,0.923880f,0.270598f,
  0.653281f,0.707107f,0.270598f,0.270598f,0.923880f,0.270598f,0.500000f,0.707107f,0.500000f,
  0.500000f,0.707107f,0.500000f,0.270598f,0.923880f,0.270598f,0.146447f,0.923880f,0.353553f,
  0.500000f,0.707107f,0.500000f,0.146447f,0.923880f,0.353553f,0.270598f,0.707107f,0.653281f,
  0.270598f,0.707107f,0.653281f,0.146447f,0.923880f,0.353553f,0.000000f,0.923880f,0.382683f,
  0.270598f,0.707107f,0.653281f,0.000000f,0.923880f,0.382683f,0.000000f,0.707107f,0.707107f,
  0.000000f,0.707107f,0.707107f,0.000000f,0.923880f,0.382683f,-0.146447f,0.923880f,0.353553f,
  0.000000f,0.707107f,0.707107f,-0.146447f,0.923880f,0.353553f,-0.270598f,0.707107f,0.653281f,
  -0.270598f,0.707107f,0.653281f,-0.146447f,0.923880f,0.353553f,-0.270598f,0.923880f,0.270598f,
  -0.270598f,0.707107f,0.653281f,-0.270598f,0.923880f,0.270598f,-0.500000f,0.707107f,0.500000f,
  -0.500000f,0.707107f,0.500000f,-0.270598f,0.923880f,0.270598f,-0.353553f,0.923880f,0.146447f,
  -0.500000f,0.707107f,0.500000f,-0.353553f,0.923880f,0.146447f,-0.653281f,0.707107f,0.270598f,
  -0.653281f,0.707107f,0.270598f,-0.353553f,0.923880f,0.146447f,-0.382683f,0.923880f,0.000000f,
  -0.653281f,0.707107f,0.270598f,-0.382683f,0.923880f,0.000000f,-0.707107f,0.707107f,0.000000f,
  -0.707107f,0.707107f,0.000000f,-0.382683f,0.923880f,0.000000f,-0.353553f,0.923880f,-0.146447f,
  -0.707107f,0.707107f,0.000000f,-0.353553f,0.923880f,-0.146447f,-0.653281f,0.707107f,-0.270598f,
  -0.653281f,0.707107f,-0.270598f,-0.353553f,0.923880f,-0.146447f,-0.270598f,0.923880f,-0.270598f,
  -0.653281f,0.707107f,-0.270598f,-0.270598f,0.923880f,-0.270598f,-0.500000f,0.707107f,-0.500000f,
  -0.500000f,0.707107f,-0.500000f,-0.270598f,0.923880f,-0.270598f,-0.146447f,0.923880f,-0.353553f,
  -0.500000f,0.707107f,-0.500000f,-0.146447f,0.923880f,-0.353553f,-0.270598f,0.707107f,-0.653281f,
  -0.270598f,0.707107f,-0.653281f,-0.146447f,0.923880f,-0.353553f,-0.000000f,0.923880f,-0.382683f,
  -0.270598f,0.707107f,-0.653281f,-0.000000f,0.923880f,-0.382683f,-0.000000f,0.707107f,-0.707107f,
  -0.000000f,0.707107f,-0.707107f,-0.000000f,0.923880f,-0.382683f,0.146447f,0.923880f,-0.353553f,
  -0.000000f,0.707107f,-0.707107f,0.146447f,0.923880f,-0.353553f,0.270598f,0.707107f,-0.653281f,
  0.270598f,0.707107f,-0.653281f,0.146447f,0.923880f,-0.353553f,0.270598f,0.923880f,-0.270598f,
  0.270598f,0.707107f,-0.653281f,0.270598f,0.923880f,-0.270598f,0.500000f,0.707107f,-0.500000f,
  0.500000f,0.707107f,-0.500000f,0.270598f,0.923880f,-0.270598f,0.353553f,0.923880f,-0.146447f,
  0.500000f,0.707107f,-0.500000f,0.353553f,0.923880f,-0.146447f,0.653281f,0.707107f,-0.270598f,
  0.653281f,0.707107f,-0.270598f,0.382683f,0.923880f,0.000000f,0.707107f,0.707107f,0.000000f,
  0.653281f,0.707107f,-0.270598f,0.353553f,0.923880f,-0.146447f,0.382683f,0.923880f,0.000000f,
  0.923880f,0.382683f,0.000000f,0.707107f,0.707107f,0.000000f,0.653281f,0.707107f,0.270598f,
  0.923880f,0.382683f,0.000000f,0.653281f,0.707107f,0.270598f,0.853553f,0.382683f,0.353553f,
  0.853553f,0.382683f,0.353553f,0.653281f,0.707107f,0.270598f,0.500000f,0.707107f,0.500000f,
  0.853553f,0.382683f,0.353553f,0.500000f,0.707107f,0.500000f,0.653281f,0.382683f,0.653281f,
  0.653281f,0.382683f,0.653281f,0.500000f,0.707107f,0.500000f,0.270598f,0.707107f,0.653281f,
  0.653281f,0.382683f,0.653281f,0.270598f,0.707107f,0.653281f,0.353553f,0.382683f,0.853553f,
  0.353553f,0.382683f,0.853553f,0.270598f,0.707107f,0.653281f,0.000000f,0.707107f,0.707107f,
  0.353553f,0.382683f,0.853553f,0.000000f,0.707107f,0.707107f,0.000000f,0.382683f,0.923880f,
  0.000000f,0.382683f,0.923880f,0.000000f,0.707107f,0.707107f,-0.270598f,0.707107f,0.653281f,
  0.000000f,0.382683f,0.923880f,-0.270598f,0.707107f,0.653281f,-0.353553f,0.382683f,0.853553f,
  -0.353553f,0.382683f,0.853553f,-0.270598f,0.707107f,0.653281f,-0.500000f,0.707107f,0.500000f,
  -0.353553f,0.382683f,0.853553f,-0.500000f,0.707107f,0.500000f,-0.653281f,0.382683f,0.653281f,
  -0.653281f,0.382683f,0.653281f,-0.500000f,0.707107f,0.500000f,-0.653281f,0.707107f,0.270598f,
  -0.653281f,0.382683f,0.653281f,-0.653281f,0.707107f,0.270598f,-0.853553f,0.382683f,0.353553f,
  -0.853553f,0.382683f,0.353553f,-0.653281f,0.707107f,0.270598f,-0.707107f,0.707107f,0.000000f,
  -0.853553f,0.382683f,0.353553f,-0.707107f,0.707107f,0.000000f,-0.923880f,0.382683f,0.000000f,
  -0.923880f,0.382683f,0.000000f,-0.707107f,0.707107f,0.000000f,-0.653281f,0.707107f,-0.270598f,
  -0.923880f,0.382683f,0.000000f,-0.653281f,0.707107f,-0.270598f,-0.853553f,0.382683f,-0.353553f,
  -0.853553f,0.382683f,-0.353553f,-0.653281f,0.707107f,-0.270598f,-0.500000f,0.707107f,-0.500000f,
  -0.853553f,0.382683f,-0.353553f,-0.500000f,0.707107f,-0.500000f,-0.653281f,0.382683f,-0.653281f,
  -0.653281f,0.382683f,-0.653281f,-0.500000f,0.707107f,-0.500000f,-0.270598f,0.707107f,-0.653281f,
  -0.653281f,0.382683f,-0.653281f,-0.270598f,0.707107f,-0.653281f,-0.353553f,0.382683f,-0.853553f,
  -0.353553f,0.382683f,-0.853553f,-0.270598f,0.707107f,-0.653281f,-0.000000f,0.707107f,-0.707107f,
  -0.353553f,0.382683f,-0.853553f,-0.000000f,0.707107f,-0.707107f,-0.000000f,0.382683f,-0.923880f,
  -0.000000f,0.382683f,-0.923880f,-0.000000f,0.707107f,-0.707107f,0.270598f,0.707107f,-0.653281f,
  -0.000000f,0.382683f,-0.923880f,0.270598f,0.707107f,-0.653281f,0.353553f,0.382683f,-0.853553f,
  0.353553f,0.382683f,-0.853553f,0.270598f,0.707107f,-0.653281f,0.500000f,0.707107f,-0.500000f,
  0.353553f,0.382683f,-0.853553f,0.500000f,0.707107f,-0.500000f,0.653281f,0.382683f,-0.653281f,
  0.653281f,0.382683f,-0.653281f,0.500000f,0.707107f,-0.500000f,0.653281f,0.707107f,-0.270598f,
  0.653281f,0.382683f,-0.653281f,0.653281f,0.707107f,-0.270598f,0.853553f,0.382683f,-0.353553f,
  0.853553f,0.382683f,-0.353553f,0.707107f,0.707107f,0.000000f,0.923880f,0.382683f,0.000000f,
  0.853553f,0.382683f,-0.353553f,0.653281f,0.707107f,-0.270598f,0.707107f,0.707107f,0.000000f,
  1.000000f,0.000000f,0.000000f,0.923880f,0.382683f,0.000000f,0.853553f,0.382683f,0.353553f,
  1.000000f,0.000000f,0.000000f,0.853553f,0.382683f,0.353553f,0.923880f,0.000000f,0.382683f,
  0.923880f,0.000000f,0.382683f,0.853553f,0.382683f,0.353553f,0.653281f,0.382683f,0.653281f,
  0.923880f,0.000000f,0.382683f,0.653281f,0.382683f,0.653281f,0.707107f,0.000000f,0.707107f,
  0.707107f,0.000000f,0.707107f,0.653281f,0.382683f,0.653281f,0.353553f,0.382683f,0.853553f,
  0.707107f,0.000000f,0.707107f,0.353553f,0.382683f,0.853553f,0.382683f,0.000000f,0.923880f,
  0.382683f,0.000000f,0.923880f,0.353553f,0.382683f,0.853553f,0.000000f,0.382683f,0.923880f,
  0.382683f,0.000000f,0.923880f,0.000000f,0.382683f,0.923880f,0.000000f,0.000000f,1.000000f,
  0.000000f,0.000000f,1.000000f,0.000000f,0.382683f,0.923880f,-0.353553f,0.382683f,0.853553f,
  0.000000f,0.000000f,1.000000f,-0.353553f,0.382683f,0.853553f,-0.382683f,0.000000f,0.923880f,
  -0.382683f,0.000000f,0.923880f,-0.353553f,0.382683f,0.853553f,-0.653281f,0.382683f,0.653281f,
  -0.382683f,0.000000f,0.923880f,-0.653281f,0.382683f,0.653281f,-0.707107f,0.000000f,0.707107f,
  -0.707107f,0.000000f,0.707107f,-0.653281f,0.382683f,0.653281f,-0.853553f,0.382683f,0.353553f,
  -0.707107f,0.000000f,0.707107f,-0.853553f,0.382683f,0.353553f,-0.923880f,0.000000f,0.382683f,
  -0.923880f,0.000000f,0.382683f,-0.853553f,0.382683f,0.353553f,-0.923880f,0.382683f,0.000000f,
  -0.923880f,0.000000f,0.382683f,-0.923880f,0.382683f,0.000000f,-1.000000f,0.000000f,0.000000f,
  -1.000000f,0.000000f,0.000000f,-0.923880f,0.382683f,0.000000f,-0.853553f,0.382683f,-0.353553f,
  -1.000000f,0.000000f,0.000000f,-0.853553f,0.382683f,-0.353553f,-0.923880f,0.000000f,-0.382683f,
  -0.923880f,0.000000f,-0.382683f,-0.853553f,0.382683f,-0.353553f,-0.653281f,0.382683f,-0.653281f,
  -0.923880f,0.000000f,-0.382683f,-0.653281f,0.382683f,-0.653281f,-0.707107f,0.000000f,-0.707107f,
  -0.707107f,0.000000f,-0.707107f,-0.653281f,0.382683f,-0.653281f,-0.353553f,0.382683f,-0.853553f,
  -0.707107f,0.000000f,-0.707107f,-0.353553f,0.382683f,-0.853553f,-0.382683f,0.000000f,-0.923880f,
  -0.382683f,0.000000f,-0.923880f,-0.353553f,0.382683f,-0.853553f,-0.000000f,0.382683f,-0.923880f,
  -0.382683f,0.000000f,-0.923880f,-0.000000f,0.382683f,-0.923880f,-0.000000f,0.000000f,-1.000000f,
  -0.000000f,0.000000f,-1.000000f,-0.000000f,0.382683f,-0.923880f,0.353553f,0.382683f,-0.853553f,
  -0.000000f,0.000000f,-1.000000f,0.353553f,0.382683f,-0.853553f,0.382683f,0.000000f,-0.923880f,
  0.382683f,0.000000f,-0.923880f,0.353553f,0.382683f,-0.853553f,0.653281f,0.382683f,-0.653281f,
  0.382683f,0.000000f,-0.923880f,0.653281f,0.382683f,-0.653281f,0.707107f,0.000000f,-0.707107f,
  0.707107f,0.000000f,-0.707107f,0.653281f,0.382683f,-0.653281f,0.853553f,0.382683f,-0.353553f,
  0.707107f,0.000000f,-0.707107f,0.853553f,0.382683f,-0.353553f,0.923880f,0.000000f,-0.382683f,
  0.923880f,0.000000f,-0.382683f,0.923880f,0.382683f,0.000000f,1.000000f,0.000000f,0.000000f,
  0.923880f,0.000000f,-0.382683f,0.853553f,0.382683f,-0.353553f,0.923880f,0.382683f,0.000000f,
  0.923880f,-0.382683f,0.000000f,1.000000f,0.000000f,0.000000f,0.923880f,0.000000f,0.382683f,
  0.923880f,-0.382683f,0.000000f,0.923880f,0.000000f,0.382683f,0.853553f,-0.382683f,0.353553f,
  0.853553f,-0.382683f,0.353553f,0.923880f,0.000000f,0.382683f,0.707107f,0.000000f,0.707107f,
  0.853553f,-0.382683f,0.353553f,0.707107f,0.000000f,0.707107f,0.653281f,-0.382683f,0.653281f,
  0.653281f,-0.382683f,0.653281f,0.707107f,0.000000f,0.707107f,0.382683f,0.000000f,0.923880f,
  0.653281f,-0.382683f,0.653281f,0.382683f,0.000000f,0.923880f,0.353553f,-0.382683f,0.853553f,
  0.353553f,-0.382683f,0.853553f,0.382683f,0.000000f,0.923880f,0.000000f,0.000000f,1.000000f,
  0.353553f,-0.382683f,0.853553f,0.000000f,0.000000f,1.000000f,0.000000f,-0.382683f,0.923880f,
  0.000000f,-0.382683f,0.923880f,0.000000f,0.000000f,1.000000f,-0.382683f,0.000000f,0.923880f,
  0.000000f,-0.382683f,0.923880f,-0.382683f,0.000000f,0.923880f,-0.353553f,-0.382683f,0.853553f,
  -0.353553f,-0.382683f,0.853553f,-0.382683f,0.000000f,0.923880f,-0.707107f,0.000000f,0.707107f,
  -0.353553f,-0.382683f,0.853553f,-0.707107f,0.000000f,0.707107f,-0.653281f,-0.382683f,0.653281f,
  -0.653281f,-0.382683f,0.653281f,-0.707107f,0.000000f,0.707107f,-0.923880f,0.000000f,0.382683f,
  -0.653281f,-0.382683f,0.653281f,-0.923880f,0.000000f,0.382683f,-0.853553f,-0.382683f,0.353553f,
  -0.853553f,-0.382683f,0.353553f,-0.923880f,0.000000f,0.382683f,-1.000000f,0.000000f,0.000000f,
  -0.853553f,-0.382683f,0.353553f,-1.000000f,0.000000f,0.000000f,-0.923880f,-0.382683f,0.000000f,
  -0.923880f,-0.382683f,0.000000f,-1.000000f,0.000000f,0.000000f,-0.923880f,0.000000f,-0.382683f,
  -0.923880f,-0.382683f,0.000000f,-0.923880f,0.000000f,-0.382683f,-0.853553f,-0.382683f,-0.353553f,
  -0.853553f,-0.382683f,-0.353553f,-0.923880f,0.000000f,-0.382683f,-0.707107f,0.000000f,-0.707107f,
  -0.853553f,-0.382683f,-0.353553f,-0.707107f,0.000000f,-0.707107f,-0.653281f,-0.382683f,-0.653281f,
  -0.653281f,-0.382683f,-0.653281f,-0.707107f,0.000000f,-0.707107f,-0.382683f,0.000000f,-0.923880f,
  -0.653281f,-0.382683f,-0.653281f,-0.382683f,0.000000f,-0.923880f,-0.353553f,-0.382683f,-0.853553f,
  -0.353553f,-0.382683f,-0.853553f,-0.382683f,0.000000f,-0.923880f,-0.000000f,0.000000f,-1.000000f,
  -0.353553f,-0.382683f,-0.853553f,-0.000000f,0.000000f,-1.000000f,-0.000000f,-0.382683f,-0.923880f,
  -0.000000f,-0.382683f,-0.923880f,-0.000000f,0.000000f,-1.000000f,0.382683f,0.000000f,-0.923880f,
  -0.000000f,-0.382683f,-0.923880f,0.382683f,0.000000f,-0.923880f,0.353553f,-0.382683f,-0.853553f,
  0.353553f,-0.382683f,-0.853553f,0.382683f,0.000000f,-0.923880f,0.707107f,0.000000f,-0.707107f,
  0.353553f,-0.382683f,-0.853553f,0.707107f,0.000000f,-0.707107f,0.653281f,-0.382683f,-0.653281f,
  0.653281f,-0.382683f,-0.653281f,0.707107f,0.000000f,-0.707107f,0.923880f,0.000000f,-0.382683f,
  0.653281f,-0.382683f,-0.653281f,0.923880f,0.000000f,-0.382683f,0.853553f,-0.382683f,-0.353553f,
  0.853553f,-0.382683f,-0.353553f,1.000000f,0.000000f,0.000000f,0.923880f,-0.382683f,0.000000f,
  0.853553f,-0.382683f,-0.353553f,0.923880f,0.000000f,-0.382683f,1.000000f,0.000000f,0.000000f,
  0.707107f,-0.707107f,0.000000f,0.923880f,-0.382683f,0.000000f,0.853553f,-0.382683f,0.353553f,
  0.707107f,-0.707107f,0.000000f,0.853553f,-0.382683f,0.353553f,0.653281f,-0.707107f,0.270598f,
  0.653281f,-0.707107f,0.270598f,0.853553f,-0.382683f,0.353553f,0.653281f,-0.382683f,0.653281f,
  0.653281f,-0.707107f,0.270598f,0.653281f,-0.382683f,0.653281f,0.500000f,-0.707107f,0.500000f,
  0.500000f,-0.707107f,0.500000f,0.653281f,-0.382683f,0.653281f,0.353553f,-0.382683f,0.853553f,
  0.500000f,-0.707107f,0.500000f,0.353553f,-0.382683f,0.853553f,0.270598f,-0.707107f,0.653281f,
  0.270598f,-0.707107f,0.653281f,0.353553f,-0.382683f,0.853553f,0.000000f,-0.382683f,0.923880f,
  0.270598f,-0.707107f,0.653281f,0.000000f,-0.382683f,0.923880f,0.000000f,-0.707107f,0.707107f,
  0.000000f,-0.707107f,0.707107f,0.000000f,-0.382683f,0.923880f,-0.353553f,-0.382683f,0.853553f,
  0.000000f,-0.707107f,0.707107f,-0.353553f,-0.382683f,0.853553f,-0.270598f,-0.707107f,0.653281f,
  -0.270598f,-0.707107f,0.653281f,-0.353553f,-0.382683f,0.853553f,-0.653281f,-0.382683f,0.653281f,
  -0.270598f,-0.707107f,0.653281f,-0.653281f,-0.382683f,0.653281f,-0.500000f,-0.707107f,0.500000f,
  -0.500000f,-0.707107f,0.500000f,-0.653281f,-0.382683f,0.653281f,-0.853553f,-0.382683f,0.353553f,
  -0.500000f,-0.707107f,0.500000f,-0.853553f,-0.382683f,0.353553f,-0.653281f,-0.707107f,0.270598f,
  -0.653281f,-0.707107f,0.270598f,-0.853553f,-0.382683f,0.353553f,-0.923880f,-0.382683f,0.000000f,
  -0.653281f,-0.707107f,0.270598f,-0.923880f,-0.382683f,0.000000f,-0.707107f,-0.707107f,0.000000f,
  -0.707107f,-0.707107f,0.000000f,-0.923880f,-0.382683f,0.000000f,-0.853553f,-0.382683f,-0.353553f,
  -0.707107f,-0.707107f,0.000000f,-0.853553f,-0.382683f,-0.353553f,-0.653281f,-0.707107f,-0.270598f,
  -0.653281f,-0.707107f,-0.270598f,-0.853553f,-0.382683f,-0.353553f,-0.653281f,-0.382683f,-0.653281f,
  -0.653281f,-0.707107f,-0.270598f,-0.653281f,-0.382683f,-0.653281f,-0.500000f,-0.707107f,-0.500000f,
  -0.500000f,-0.707107f,-0.500000f,-0.653281f,-0.382683f,-0.653281f,-0.353553f,-0.382683f,-0.853553f,
  -0.500000f,-0.707107f,-0.500000f,-0.353553f,-0.382683f,-0.853553f,-0.270598f,-0.707107f,-0.653281f,
  -0.270598f,-0.707107f,-0.653281f,-0.353553f,-0.382683f,-0.853553f,-0.000000f,-0.382683f,-0.923880f,
  -0.270598f,-0.707107f,-0.653281f,-0.000000f,-0.382683f,-0.923880f,-0.000000f,-0.707107f,-0.707107f,
  -0.000000f,-0.707107f,-0.707107f,-0.000000f,-0.382683f,-0.923880f,0.353553f,-0.382683f,-0.853553f,
  -0.000000f,-0.707107f,-0.707107f,0.353553f,-0.382683f,-0.853553f,0.270598f,-0.707107f,-0.653281f,
  0.270598f,-0.707107f,-0.653281f,0.353553f,-0.382683f,-0.853553f,0.653281f,-0.382683f,-0.653281f,
  0.270598f,-0.707107f,-0.653281f,0.653281f,-0.382683f,-0.653281f,0.500000f,-0.707107f,-0.500000f,
  0.500000f,-0.707107f,-0.500000f,0.653281f,-0.382683f,-0.653281f,0.853553f,-0.382683f,-0.353553f,
  0.500000f,-0.707107f,-0.500000f,0.853553f,-0.382683f,-0.353553f,0.653281f,-0.707107f,-0.270598f,
  0.653281f,-0.707107f,-0.270598f,0.923880f,-0.382683f,0.000000f,0.707107f,-0.707107f,0.000000f,
  0.653281f,-0.707107f,-0.270598f,0.853553f,-0.382683f,-0.353553f,0.923880f,-0.382683f,0.000000f,
  0.382683f,-0.923880f,0.000000f,0.707107f,-0.707107f,0.000000f,0.653281f,-0.707107f,0.270598f,
  0.382683f,-0.923880f,0.000000f,0.653281f,-0.707107f,0.270598f,0.353553f,-0.923880f,0.146447f,
  0.353553f,-0.923880f,0.146447f,0.653281f,-0.707107f,0.270598f,0.500000f,-0.707107f,0.500000f,
  0.353553f,-0.923880f,0.146447f,0.500000f,-0.707107f,0.500000f,0.270598f,-0.923880f,0.270598f,
  0.270598f,-0.923880f,0.270598f,0.500000f,-0.707107f,0.500000f,0.270598f,-0.707107f,0.653281f,
  0.270598f,-0.923880f,0.270598f,0.270598f,-0.707107f,0.653281f,0.146447f,-0.923880f,0.353553f,
  0.146447f,-0.923880f,0.353553f,0.270598f,-0.707107f,0.653281f,0.000000f,-0.707107f,0.707107f,
  0.146447f,-0.923880f,0.353553f,0.000000f,-0.707107f,0.707107f,0.000000f,-0.923880f,0.382683f,
  0.000000f,-0.923880f,0.382683f,0.000000f,-0.707107f,0.707107f,-0.270598f,-0.707107f,0.653281f,
  0.000000f,-0.923880f,0.382683f,-0.270598f,-0.707107f,0.653281f,-0.146447f,-0.923880f,0.353553f,
  -0.146447f,-0.923880f,0.353553f,-0.270598f,-0.707107f,0.653281f,-0.500000f,-0.707107f,0.500000f,
  -0.146447f,-0.923880f,0.353553f,-0.500000f,-0.707107f,0.500000f,-0.270598f,-0.923880f,0.270598f,
  -0.270598f,-0.923880f,0.270598f,-0.500000f,-0.707107f,0.500000f,-0.653281f,-0.707107f,0.270598f,
  -0.270598f,-0.923880f,0.270598f,-0.653281f,-0.707107f,0.270598f,-0.353553f,-0.923880f,0.146447f,
  -0.353553f,-0.923880f,0.146447f,-0.653281f,-0.707107f,0.270598f,-0.707107f,-0.707107f,0.000000f,
  -0.353553f,-0.923880f,0.146447f,-0.707107f,-0.707107f,0.000000f,-0.382683f,-0.923880f,0.000000f,
  -0.382683f,-0.923880f,0.000000f,-0.707107f,-0.707107f,0.000000f,-0.653281f,-0.707107f,-0.270598f,
  -0.382683f,-0.923880f,0.000000f,-0.653281f,-0.707107f,-0.270598f,-0.353553f,-0.923880f,-0.146447f,
  -0.353553f,-0.923880f,-0.146447f,-0.653281f,-0.707107f,-0.270598f,-0.500000f,-0.707107f,-0.500000f,
  -0.353553f,-0.923880f,-0.146447f,-0.500000f,-0.707107f,-0.500000f,-0.270598f,-0.923880f,-0.270598f,
  -0.270598f,-0.923880f,-0.270598f,-0.500000f,-0.707107f,-0.500000f,-0.270598f,-0.707107f,-0.653281f,
  -0.270598f,-0.923880f,-0.270598f,-0.270598f,-0.707107f,-0.653281f,-0.146447f,-0.923880f,-0.353553f,
  -0.146447f,-0.923880f,-0.353553f,-0.270598f,-0.707107f,-0.653281f,-0.000000f,-0.707107f,-0.707107f,
  -0.146447f,-0.923880f,-0.353553f,-0.000000f,-0.707107f,-0.707107f,-0.000000f,-0.923880f,-0.382683f,
  -0.000000f,-0.923880f,-0.382683f,-0.000000f,-0.707107f,-0.707107f,0.270598f,-0.707107f,-0.653281f,
  -0.000000f,-0.923880f,-0.382683f,0.270598f,-0.707107f,-0.653281f,0.146447f,-0.923880f,-0.353553f,
  0.146447f,-0.923880f,-0.353553f,0.270598f,-0.707107f,-0.653281f,0.500000f,-0.707107f,-0.500000f,
  0.146447f,-0.923880f,-0.353553f,0.500000f,-0.707107f,-0.500000f,0.270598f,-0.923880f,-0.270598f,
  0.270598f,-0.923880f,-0.270598f,0.500000f,-0.707107f,-0.500000f,0.653281f,-0.707107f,-0.270598f,
  0.270598f,-0.923880f,-0.270598f,0.653281f,-0.707107f,-0.270598f,0.353553f,-0.923880f,-0.146447f,
  0.353553f,-0.923880f,-0.146447f,0.707107f,-0.707107f,0.000000f,0.382683f,-0.923880f,0.000000f,
  0.353553f,-0.923880f,-0.146447f,0.653281f,-0.707107f,-0.270598f,0.707107f,-0.707107f,0.000000f,
  0.000000f,1.000000f,0.000000f,0.382683f,0.923880f,0.000000f,0.353553f,0.923880f,-0.146447f,
  0.000000f,1.000000f,0.000000f,0.353553f,0.923880f,0.146447f,0.382683f,0.923880f,0.000000f,
  0.000000f,1.000000f,0.000000f,0.270598f,0.923880f,0.270598f,0.353553f,0.923880f,0.146447f,
  0.000000f,1.000000f,0.000000f,0.146447f,0.923880f,0.353553f,0.270598f,0.923880f,0.270598f,
  0.000000f,1.000000f,0.000000f,0.000000f,0.923880f,0.382683f,0.146447f,0.923880f,0.353553f,
  0.000000f,1.000000f,0.000000f,-0.146447f,0.923880f,0.353553f,0.000000f,0.923880f,0.382683f,
  0.000000f,1.000000f,0.000000f,-0.270598f,0.923880f,0.270598f,-0.146447f,0.923880f,0.353553f,
  0.000000f,1.000000f,0.000000f,-0.353553f,0.923880f,0.146447f,-0.270598f,0.923880f,0.270598f,
  0.000000f,1.000000f,0.000000f,-0.382683f,0.923880f,0.000000f,-0.353553f,0.923880f,0.146447f,
  0.000000f,1.000000f,0.000000f,-0.353553f,0.923880f,-0.146447f,-0.382683f,0.923880f,0.000000f,
  0.000000f,1.000000f,0.000000f,-0.270598f,0.923880f,-0.270598f,-0.353553f,0.923880f,-0.146447f,
  0.000000f,1.000000f,0.000000f,-0.146447f,0.923880f,-0.353553f,-0.270598f,0.923880f,-0.270598f,
  0.000000f,1.000000f,0.000000f,-0.000000f,0.923880f,-0.382683f,-0.146447f,0.923880f,-0.353553f,
  0.000000f,1.000000f,0.000000f,0.146447f,0.923880f,-0.353553f,-0.000000f,0.923880f,-0.382683f,
  0.000000f,1.000000f,0.000000f,0.270598f,0.923880f,-0.270598f,0.146447f,0.923880f,-0.353553f,
  0.000000f,1.000000f,0.000000f,0.353553f,0.923880f,-0.146447f,0.270598f,0.923880f,-0.270598f,
  0.000000f,-1.000000f,0.000000f,0.382683f,-0.923880f,0.000000f,0.353553f,-0.923880f,0.146447f,
  0.000000f,-1.000000f,0.000000f,0.353553f,-0.923880f,0.146447f,0.270598f,-0.923880f,0.270598f,
  0.000000f,-1.000000f,0.000000f,0.270598f,-0.923880f,0.270598f,0.146447f,-0.923880f,0.353553f,
  0.000000f,-1.000000f,0.000000f,0.146447f,-0.923880f,0.353553f,0.000000f,-0.923880f,0.382683f,
  0.000000f,-1.000000f,0.000000f,0.000000f,-0.923880f,0.382683f,-0.146447f,-0.923880f,0.353553f,
  0.000000f,-1.000000f,0.000000f,-0.146447f,-0.923880f,0.353553f,-0.270598f,-0.923880f,0.270598f,
  0.000000f,-1.000000f,0.000000f,-0.270598f,-0.923880f,0.270598f,-0.353553f,-0.923880f,0.146447f,
  0.000000f,-1.000000f,0.000000f,-0.353553f,-0.923880f,0.146447f,-0.382683f,-0.923880f,0.000000f,
  0.000000f,-1.000000f,0.000000f,-0.382683f,-0.923880f,0.000000f,-0.353553f,-0.923880f,-0.146447f,
  0.000000f,-1.000000f,0.000000f,-0.353553f,-0.923880f,-0.146447f,-0.270598f,-0.923880f,-0.270598f,
  0.000000f,-1.000000f,0.000000f,-0.270598f,-0.923880f,-0.270598f,-0.146447f,-0.923880f,-0.353553f,
  0.000000f,-1.000000f,0.000000f,-0.146447f,-0.923880f,-0.353553f,-0.000000f,-0.923880f,-0.382683f,
  0.000000f,-1.000000f,0.000000f,-0.000000f,-0.923880f,-0.382683f,0.146447f,-0.923880f,-0.353553f,
  0.000000f,-1.000000f,0.000000f,0.146447f,-0.923880f,-0.353553f,0.270598f,-0.923880f,-0.270598f,
  0.000000f,-1.000000f,0.000000f,0.270598f,-0.923880f,-0.270598f,0.353553f,-0.923880f,-0.146447f,
  0.000000f,-1.000000f,0.000000f,0.353553f,-0.923880f,-0.146447f,0.382683f,-0.923880f,0.000000f
};

int ntriangles=(int)(sizeof(triangles)/(sizeof(float)*3));

#endif

  GLMesh ret;
  ret.begin(GL_TRIANGLES);
  for (int I=0;I<ntriangles;I++)
  {
    ret.normal(triangles[I*3+0],triangles[I*3+1],triangles[I*3+2]);
    ret.vertex(triangles[I*3+0],triangles[I*3+1],triangles[I*3+2]);
  }
  ret.end();  
  return ret;
}


} //namespace

